# üèóÔ∏è 08 - Estandarizaci√≥n de Componentes ABM y Estructura de Tablas
**üìÖ √öltima Actualizaci√≥n: 20-08-2025**

## üéØ Visi√≥n General

Este documento establece las **normas de estandarizaci√≥n** para los componentes ABM (Altas, Bajas, Modificaciones) y la estructura de tablas en el Sistema SGC ISO 9001. Estas normas garantizan consistencia, mantenibilidad y escalabilidad en el desarrollo de componentes de gesti√≥n de datos.

## üìã Estructura Estandarizada de Tablas

### üóÑÔ∏è Patr√≥n Base de Tablas

Todas las tablas del sistema siguen una estructura estandarizada que incluye:

```sql
-- Campos obligatorios para todas las tablas
id                    # Identificador √∫nico (INTEGER PRIMARY KEY o TEXT)
organization_id       # Multi-tenancy (INTEGER)
created_at           # Fecha de creaci√≥n (DATETIME/TEXT)
updated_at           # Fecha de √∫ltima modificaci√≥n (DATETIME/TEXT)

-- Campos espec√≠ficos seg√∫n el tipo de entidad
-- ... campos espec√≠ficos de la entidad

-- Campos de auditor√≠a (opcionales)
created_by           # Usuario que cre√≥ el registro (INTEGER)
updated_by           # Usuario que modific√≥ el registro (INTEGER)
estado               # Estado del registro (TEXT)
```

### üîó Sistema de Relaciones Estandarizado

```sql
-- Tablas unificadas para relaciones (Propuesto)
sgc_participantes          # Participantes de cualquier proceso
sgc_documentos_relacionados # Documentos relacionados
sgc_normas_relacionadas    # Cumplimiento de normas
relaciones_sgc             # Otras relaciones espec√≠ficas
```

## üé® Estandarizaci√≥n de Componentes ABM

### üìÅ Estructura de Archivos

```
components/
‚îú‚îÄ‚îÄ [entidad]/
‚îÇ   ‚îú‚îÄ‚îÄ [Entidad]Listing.jsx      # Componente principal de listado
‚îÇ   ‚îú‚îÄ‚îÄ [Entidad]Card.jsx         # Tarjeta individual (opcional)
‚îÇ   ‚îú‚îÄ‚îÄ [Entidad]Modal.jsx        # Modal para crear/editar
‚îÇ   ‚îú‚îÄ‚îÄ [Entidad]TableView.jsx    # Vista de tabla (opcional)
‚îÇ   ‚îî‚îÄ‚îÄ [Entidad]Single.jsx       # Vista detallada individual
‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îú‚îÄ‚îÄ UnifiedHeader.jsx         # Header estandarizado
‚îÇ   ‚îú‚îÄ‚îÄ UnifiedCard.jsx           # Tarjeta estandarizada
‚îÇ   ‚îî‚îÄ‚îÄ UnifiedTable.jsx          # Tabla estandarizada
```

### üß© Componentes Unificados

#### 1. **UnifiedHeader** - Header Estandarizado

**Prop√≥sito**: Header consistente para todos los m√≥dulos ABM

**Props Requeridas**:
```javascript
{
  title: string,                    // T√≠tulo del m√≥dulo
  description: string,              // Descripci√≥n del m√≥dulo
  searchTerm: string,               // T√©rmino de b√∫squeda
  onSearchChange: function,         // Handler de b√∫squeda
  onNew: function,                  // Handler para nuevo registro
  onExport: function,               // Handler de exportaci√≥n
  viewMode: 'grid' | 'list',        // Modo de vista
  onViewModeChange: function,       // Handler cambio de vista
  newButtonText: string,            // Texto del bot√≥n nuevo
  totalCount: number,               // Total de registros
  lastUpdated: string,              // √öltima actualizaci√≥n
  icon: Component,                  // Icono del m√≥dulo
  primaryColor: string              // Color primario
}
```

**Caracter√≠sticas**:
- Header con gradiente personalizable
- Barra de b√∫squeda integrada
- Controles de vista (grid/list)
- Botones de acci√≥n (nuevo, exportar)
- Contador de registros
- Indicador de √∫ltima actualizaci√≥n

#### 2. **UnifiedCard** - Tarjeta Estandarizada

**Prop√≥sito**: Tarjeta consistente para mostrar registros

**Props Requeridas**:
```javascript
{
  title: string,                    // T√≠tulo del registro
  subtitle: string,                 // Subt√≠tulo (opcional)
  description: string,              // Descripci√≥n
  status: string,                   // Estado del registro
  fields: Array,                    // Campos adicionales
  onEdit: function,                 // Handler de edici√≥n
  onDelete: function,               // Handler de eliminaci√≥n
  onView: function,                 // Handler de visualizaci√≥n
  icon: Component,                  // Icono
  primaryColor: string              // Color primario
}
```

**Estructura de Fields**:
```javascript
fields: [
  {
    icon: Component,    // Icono del campo
    label: string,      // Etiqueta del campo
    value: string       // Valor del campo
  }
]
```

**Caracter√≠sticas**:
- Header con gradiente y c√≥digo
- Contenido estructurado
- Footer con acciones (Ver, Editar, Eliminar)
- Estados visuales consistentes
- Animaciones con Framer Motion

### üìä Patr√≥n de Componente Listing

#### Estructura Est√°ndar

```javascript
const [entidad]Listing = () => {
  // Estados
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);
  const [viewMode, setViewMode] = useState('grid');

  // Handlers estandarizados
  const handleOpenModal = (item = null) => { /* ... */ };
  const handleCloseModal = () => { /* ... */ };
  const handleSave = async (itemData) => { /* ... */ };
  const handleDelete = async (item) => { /* ... */ };
  const handleCardClick = (item) => { /* ... */ };
  const handleExport = () => { /* ... */ };

  // Filtrado
  const filteredData = data.filter(item => /* l√≥gica de filtrado */);

  // Estad√≠sticas
  const getStats = () => { /* ... */ };

  // Renderizado
  return (
    <div className="p-6 space-y-6">
      <UnifiedHeader /* props */ />
      
      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        {/* Cards de estad√≠sticas */}
      </div>

      {/* Contenido */}
      {viewMode === 'grid' ? renderGridView() : renderListView()}

      {/* Modal */}
      <[Entidad]Modal /* props */ />
    </div>
  );
};
```

#### ‚ö†Ô∏è **IMPORTANTE: Ubicaci√≥n de Botones de Acci√≥n**

**Patr√≥n Correcto (Seguir este patr√≥n):**
- ‚úÖ **Bot√≥n "Nuevo"**: En el `UnifiedHeader` (como en Personal y Puestos)
- ‚úÖ **Botones de Acci√≥n**: Dentro de cada tarjeta/registro (Ver, Editar, Eliminar)
- ‚úÖ **Bot√≥n "Exportar"**: En el `UnifiedHeader`

**Patr√≥n Incorrecto (NO seguir):**
- ‚ùå **Botones de acci√≥n en el men√∫ lateral**: Los botones como "Nuevo Cliente", "Lista de Clientes", etc. NO deben estar en el men√∫ lateral
- ‚ùå **Acciones duplicadas**: No tener el mismo bot√≥n en m√∫ltiples lugares

**Ejemplo de Implementaci√≥n Correcta:**
```javascript
// ‚úÖ CORRECTO - En UnifiedHeader
<UnifiedHeader
  title="Gesti√≥n de Clientes"
  description="Administra la base de datos de clientes"
  searchTerm={searchTerm}
  onSearchChange={setSearchTerm}
  onNew={() => handleOpenModal()}  // ‚Üê Bot√≥n "Nuevo" aqu√≠
  onExport={handleExport}          // ‚Üê Bot√≥n "Exportar" aqu√≠
  viewMode={viewMode}
  onViewModeChange={setViewMode}
  newButtonText="Nuevo Cliente"    // ‚Üê Texto del bot√≥n
  totalCount={clientes.length}
  lastUpdated="hoy"
  icon={Users}
  primaryColor="slate"
/>

// ‚úÖ CORRECTO - En cada tarjeta
<UnifiedCard
  title={cliente.nombre}
  description={cliente.descripcion}
  onView={() => handleCardClick(cliente)}    // ‚Üê Ver
  onEdit={() => handleOpenModal(cliente)}    // ‚Üê Editar
  onDelete={() => handleDelete(cliente)}     // ‚Üê Eliminar
  // ... otros props
/>
```

#### Funciones Estandarizadas

1. **fetchData()**: Carga de datos desde API
2. **handleOpenModal()**: Apertura de modal para crear/editar
3. **handleSave()**: Guardado de datos (crear/actualizar)
4. **handleDelete()**: Eliminaci√≥n con confirmaci√≥n
5. **handleCardClick()**: Navegaci√≥n a vista detallada
6. **handleExport()**: Exportaci√≥n de datos
7. **getStats()**: C√°lculo de estad√≠sticas
8. **renderGridView()**: Vista en cuadr√≠cula
9. **renderListView()**: Vista en lista

### üé® Sistema de Colores Estandarizado

#### Paleta de Colores por M√≥dulo

```javascript
const colorSchemes = {
  emerald: {  // Personal, Recursos Humanos
    gradient: 'from-emerald-500 to-emerald-600',
    button: 'bg-emerald-600 hover:bg-emerald-700 text-white',
    badge: 'bg-emerald-100 text-emerald-800 border-emerald-200',
    iconColor: 'text-emerald-500',
    viewButton: 'text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50'
  },
  blue: {     // Procesos, Documentos
    gradient: 'from-blue-500 to-blue-600',
    button: 'bg-blue-600 hover:bg-blue-700 text-white',
    badge: 'bg-blue-100 text-blue-800 border-blue-200',
    iconColor: 'text-blue-500',
    viewButton: 'text-blue-600 hover:text-blue-700 hover:bg-blue-50'
  },
  purple: {   // Auditor√≠as, Hallazgos
    gradient: 'from-purple-500 to-purple-600',
    button: 'bg-purple-600 hover:bg-purple-700 text-white',
    badge: 'bg-purple-100 text-purple-800 border-purple-200',
    iconColor: 'text-purple-500',
    viewButton: 'text-purple-600 hover:text-purple-700 hover:bg-purple-50'
  },
  orange: {   // Acciones, Mejoras
    gradient: 'from-orange-500 to-orange-600',
    button: 'bg-orange-600 hover:bg-orange-700 text-white',
    badge: 'bg-orange-100 text-orange-800 border-orange-200',
    iconColor: 'text-orange-500',
    viewButton: 'text-orange-600 hover:text-orange-700 hover:bg-orange-50'
  },
  slate: {    // CRM, Configuraci√≥n
    gradient: 'from-slate-500 to-slate-600',
    button: 'bg-slate-600 hover:bg-slate-700 text-white',
    badge: 'bg-slate-100 text-slate-800 border-slate-200',
    iconColor: 'text-slate-500',
    viewButton: 'text-slate-600 hover:text-slate-700 hover:bg-slate-50'
  }
};
```

#### Estados Visuales Estandarizados

```javascript
const getStatusColor = (status) => {
  switch (status?.toLowerCase()) {
    case 'activo':
    case 'completado':
    case 'completada':
    case 'excelente':
      return 'bg-green-100 text-green-800 border-green-200';
    case 'en_proceso':
    case 'en progreso':
    case 'pendiente':
    case 'bueno':
      return 'bg-yellow-100 text-yellow-800 border-yellow-200';
    case 'cancelado':
    case 'cancelada':
    case 'inactivo':
    case 'regular':
    case 'necesita mejora':
      return 'bg-red-100 text-red-800 border-red-200';
    default:
      return 'bg-gray-100 text-gray-800 border-gray-200';
  }
};
```

## üîß Patrones de Implementaci√≥n

### 1. **Patr√≥n de Servicios**

```javascript
// services/[entidad]Service.js
class [Entidad]Service {
  static async getAll[Entidad]() { /* ... */ }
  static async get[Entidad]ById(id) { /* ... */ }
  static async create[Entidad](data) { /* ... */ }
  static async update[Entidad](id, data) { /* ... */ }
  static async delete[Entidad](id) { /* ... */ }
  static async export[Entidad]() { /* ... */ }
}
```

### 2. **Patr√≥n de Validaci√≥n**

```javascript
// schemas/[entidad]Schemas.js
import { z } from 'zod';

export const [entidad]Schema = z.object({
  // Campos espec√≠ficos de la entidad
  nombre: z.string().min(1, 'El nombre es requerido'),
  descripcion: z.string().optional(),
  estado: z.enum(['activo', 'inactivo']).default('activo'),
  // ... otros campos
});
```

### 3. **Patr√≥n de Estados**

```javascript
// Estados estandarizados para todas las entidades
const estados = {
  activo: 'Activo',
  inactivo: 'Inactivo',
  pendiente: 'Pendiente',
  completado: 'Completado',
  cancelado: 'Cancelado'
};
```

## üì± Responsive Design Estandarizado

### Breakpoints

```css
/* Grid responsive estandarizado */
.grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4

/* Espaciado estandarizado */
.p-6 space-y-6
.gap-4 md:gap-6
```

### Modos de Vista

1. **Grid View**: Vista en cuadr√≠cula para pantallas grandes
2. **List View**: Vista en lista para pantallas peque√±as
3. **Table View**: Vista de tabla para datos complejos

## üîÑ Flujo de Datos Estandarizado

### 1. **Carga de Datos**
```javascript
useEffect(() => {
  fetchData();
}, []);
```

### 2. **Gesti√≥n de Estados**
```javascript
const [loading, setLoading] = useState(true);
const [error, setError] = useState(null);
const [data, setData] = useState([]);
```

### 3. **Manejo de Errores**
```javascript
try {
  // Operaci√≥n
} catch (error) {
  console.error('Error:', error);
  toast({ 
    variant: "destructive", 
    title: "Error", 
    description: "Mensaje de error" 
  });
}
```

### 4. **Feedback al Usuario**
```javascript
// Toast notifications estandarizadas
toast({ title: "√âxito", description: "Operaci√≥n completada" });
toast({ variant: "destructive", title: "Error", description: "Error en operaci√≥n" });
```

## üìä Componentes de Mejoras (Workflow)

### Estructura de Workflow

```javascript
// Componentes de workflow estandarizados
- WorkflowStepper.jsx      # Stepper de etapas
- WorkflowState.jsx        # Estado del workflow
- WorkflowStage.jsx        # Etapa individual
- TiemposWorkflow.jsx      # Control de tiempos
- KanbanBoard.jsx          # Tablero Kanban
- KanbanColumn.jsx         # Columna Kanban
- KanbanCard.jsx           # Tarjeta Kanban
```

### Patr√≥n de Workflow

```javascript
const stages = [
  { id: 'deteccion', name: 'Detecci√≥n', color: 'purple' },
  { id: 'analisis', name: 'An√°lisis', color: 'blue' },
  { id: 'planificacion', name: 'Planificaci√≥n', color: 'orange' },
  { id: 'ejecucion', name: 'Ejecuci√≥n', color: 'green' },
  { id: 'verificacion', name: 'Verificaci√≥n', color: 'teal' },
  { id: 'cierre', name: 'Cierre', color: 'gray' }
];
```

## üß™ Testing Estandarizado

### Estructura de Tests

```javascript
// tests/[entidad].test.js
describe('[Entidad] Component', () => {
  test('should render correctly', () => { /* ... */ });
  test('should handle create', () => { /* ... */ });
  test('should handle update', () => { /* ... */ });
  test('should handle delete', () => { /* ... */ });
  test('should handle search', () => { /* ... */ });
});
```

## üìã Checklist de Implementaci√≥n

### ‚úÖ Para Nuevos Componentes ABM

- [ ] Crear estructura de archivos estandarizada
- [ ] Implementar UnifiedHeader con props correctas
- [ ] Implementar UnifiedCard con estructura de fields
- [ ] Crear servicio con m√©todos CRUD
- [ ] Implementar validaci√≥n con Zod
- [ ] Agregar manejo de errores estandarizado
- [ ] Implementar responsive design
- [ ] Agregar estad√≠sticas del m√≥dulo
- [ ] Implementar exportaci√≥n de datos
- [ ] Crear tests unitarios
- [ ] Documentar el componente

### ‚úÖ Para Nuevas Tablas

- [ ] Incluir campos obligatorios (id, organization_id, created_at, updated_at)
- [ ] Definir relaciones con otras tablas
- [ ] Crear √≠ndices apropiados
- [ ] Implementar constraints de integridad
- [ ] Documentar la estructura
- [ ] Crear migraciones

## üéØ Beneficios de la Estandarizaci√≥n

1. **Consistencia**: Interfaz uniforme en todo el sistema
2. **Mantenibilidad**: C√≥digo f√°cil de mantener y actualizar
3. **Escalabilidad**: F√°cil agregar nuevos m√≥dulos
4. **Reutilizaci√≥n**: Componentes reutilizables
5. **Calidad**: Menos errores y mejor testing
6. **Productividad**: Desarrollo m√°s r√°pido
7. **Experiencia de Usuario**: Navegaci√≥n intuitiva

---

*Esta estandarizaci√≥n garantiza que todos los componentes ABM del sistema SGC sigan las mismas normas y patrones, proporcionando una experiencia de usuario consistente y un c√≥digo mantenible.*

**üìÖ Versi√≥n**: 1.0  
**üë• Responsable**: Equipo de Desarrollo SGC  
**ÔøΩÔøΩ Revisi√≥n**: Anual
